# Reglas de Dominio - Ner LaTalmud

## üéØ Separaci√≥n de Responsabilidades

### ‚ùå PROHIBIDO en Componentes UI
- Crear l√≥gica de negocio
- Calcular promedios, estad√≠sticas o m√©tricas
- Validar reglas de dominio
- Transformar datos complejos
- Acceder directamente a Prisma/BD

### ‚úÖ OBLIGATORIO: Ubicaci√≥n de L√≥gica

**Toda regla de negocio debe vivir en:**
- `src/lib/*.ts` - Funciones puras, servicios, utilidades
- `src/app/actions/*.ts` - Server Actions, l√≥gica de servidor

**Ejemplos:**
- C√°lculos de promedios ‚Üí `src/lib/calculos.ts`
- Validaciones de r√∫bricas ‚Üí `src/lib/rubricas.ts`
- Generaci√≥n de PDFs ‚Üí `src/lib/pdf-service.ts`
- Obtenci√≥n de datos ‚Üí `src/app/actions/*.ts`

### üìê Las R√∫bricas Mandan sobre la UI

- La UI **consume** las r√∫bricas, no las define
- Las r√∫bricas son la **fuente de verdad**
- Si la UI necesita algo que no est√° en r√∫bricas ‚Üí **TODO expl√≠cito**
- Nunca hardcodear valores de r√∫bricas en componentes

### üìù Documentaci√≥n de Faltantes

**Si falta informaci√≥n:**
- Documentar como `// TODO:` con contexto claro
- No inventar l√≥gica funcional
- No asumir valores o reglas
- Indicar qu√© especificaci√≥n/documento falta

**Formato de TODO:**
```typescript
// TODO: [CONTEXTO] - Requiere ESPECIFICACI√ìN_MAESTRA v1.4
// Falta: [QU√â FALTA]
// Bloqueado por: [RAZ√ìN]
```

### üîÑ Flujo Correcto

```
UI Component ‚Üí Server Action ‚Üí Lib/Service ‚Üí Prisma/BD
     ‚Üì              ‚Üì              ‚Üì
  Renderiza    Orquesta      Ejecuta l√≥gica
```

**NUNCA:**
```
UI Component ‚Üí L√≥gica de negocio ‚Üí Prisma/BD
```

### ‚úÖ Ejemplos Correctos

**‚úÖ CORRECTO:**
```typescript
// src/app/actions/evaluador.ts
export async function getReporteProgreso(alumnoId: number) {
  const evaluaciones = await db.evaluacion.findMany(...);
  const promedio = calcularPromedioGlobalAlumno(evaluaciones);
  return { success: true, data: promedio };
}

// src/app/(evaluador)/reporte-progreso/[id]/page.tsx
const result = await getReporteProgreso(alumnoId);
const promedio = result.data;
```

**‚ùå INCORRECTO:**
```typescript
// src/app/(evaluador)/reporte-progreso/[id]/page.tsx
const evaluaciones = await db.evaluacion.findMany(...);
const suma = evaluaciones.reduce(...);
const promedio = suma / evaluaciones.length; // ‚ùå L√≥gica en UI
```

### üéØ Principios

1. **UI = Presentaci√≥n**: Solo renderiza y maneja eventos
2. **Actions = Orquestaci√≥n**: Coordina llamadas a servicios
3. **Lib = L√≥gica Pura**: Funciones testeables, sin efectos secundarios
4. **R√∫bricas = Fuente de Verdad**: Definiciones can√≥nicas del dominio

---

**√öltima actualizaci√≥n:** 2025-01-XX  
**Aplica desde:** Hoy
